<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    
      iOS 测试 - 准备测试环境
    
  </title>

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="iOS 测试 - 准备测试环境" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="设备越狱 目前稳定的越狱途径是使用 checkra1n，或者使用 bootra1n，一个包含 checkra1n 的 USB Linux 启动盘。" />
<meta property="og:description" content="设备越狱 目前稳定的越狱途径是使用 checkra1n，或者使用 bootra1n，一个包含 checkra1n 的 USB Linux 启动盘。" />
<link rel="canonical" href="https://blog.securitainment.io/ios/pentest/mobile/2020/09/29/getting-started-with-iOS-testing.html" />
<meta property="og:url" content="https://blog.securitainment.io/ios/pentest/mobile/2020/09/29/getting-started-with-iOS-testing.html" />
<meta property="og:site_name" content="Securitainment.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-29T22:21:00+08:00" />
<script type="application/ld+json">
{"url":"https://blog.securitainment.io/ios/pentest/mobile/2020/09/29/getting-started-with-iOS-testing.html","headline":"iOS 测试 - 准备测试环境","dateModified":"2020-09-29T22:21:00+08:00","datePublished":"2020-09-29T22:21:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.securitainment.io/ios/pentest/mobile/2020/09/29/getting-started-with-iOS-testing.html"},"description":"设备越狱 目前稳定的越狱途径是使用 checkra1n，或者使用 bootra1n，一个包含 checkra1n 的 USB Linux 启动盘。","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://blog.securitainment.io/feed.xml" title="Securitainment.io" />

  <link rel="shortcut icon" type="image/x-icon" href="/" />
  <link rel="stylesheet" href="https://blog.securitainment.io/assets/css/main.css" />
</head>
<body>
    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a href="https://blog.securitainment.io"></a>
<h1>iOS 测试 - 准备测试环境</h1>
<h2 id="设备越狱">设备越狱</h2>
<p>目前稳定的越狱途径是使用 <a href="https://checkra.in/linux">checkra1n</a>，或者使用 <a href="https://github.com/foxlet/bootra1n">bootra1n</a>，一个包含 checkra1n 的 USB Linux 启动盘。</p>

<h2 id="安装需要测试的-app">安装需要测试的 app</h2>
<ul>
  <li>注册一个不包含个人信息的测试帐号</li>
  <li>登录 App Store，安装需要测试的 app（或者使用 <a href="http://www.3u.com/">3uTools</a> 安装）</li>
</ul>

<h2 id="dump-ipa-文件">Dump IPA 文件</h2>
<ul>
  <li>在已越狱的设备上
    <ul>
      <li>打开 Cydia 商店，安装 <a href="https://frida.re/docs/ios/">frida-server</a></li>
    </ul>
  </li>
  <li>在 Kali VM 里安装 frida</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip instal frida-tools
</code></pre></div></div>

<ul>
  <li>Kali 安装 <code class="language-plaintext highlighter-rouge">frida-ios-dump</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>libusbmuxd-tools
git clone https://github.com/AloneMonkey/frida-ios-dump.git
<span class="nb">cd </span>frida-ios-dump
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>

<ul>
  <li>使用 iproxy 将设备的 SSH 端口映射到本机</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iproxy 2222 44  <span class="c"># 将设备的 44 端口（SSH）映射为本机 2222端口</span>
</code></pre></div></div>

<p>然后运行 <code class="language-plaintext highlighter-rouge">dump.py</code> ：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-p</span> 2222 root@localhost&amp;
python3 dump.py &lt;target_app_name&gt;
</code></pre></div></div>

<p>使用 <code class="language-plaintext highlighter-rouge">frida-ps</code> 来找到正确的 app 名称（target_app_name）</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>frida-ps <span class="nt">-Uai</span>
</code></pre></div></div>

<p>app 下载后使用 <code class="language-plaintext highlighter-rouge">unzip target_app_name</code> 解压 app。</p>

<h2 id="使用-debugserver-调试">使用 debugserver 调试</h2>
<p>安装 <a href="https://github.com/wstclzy2010/iOS-debugserver">debugserver</a> 到越狱的设备上。</p>

<p>运行 app，使用 <code class="language-plaintext highlighter-rouge">ps ax | grep **target_app_name**</code> 来查找 app 的进程编号，通过下面命令开启调试：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>debugserver <span class="k">*</span>:1234 <span class="nt">-a</span> <span class="k">**</span>target_app_name<span class="k">**</span> <span class="c"># 1234:远程调试端口</span>
</code></pre></div></div>

<p>在电脑端打开 LLDB 进行调试。如出现 <code class="language-plaintext highlighter-rouge">Segmentation fault: 11</code> 则程序开启了反调试。</p>

<h2 id="使用-cycript-注入-dylib-动态库">使用 Cycript 注入 dylib 动态库</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cycript <span class="nt">-p</span> 5911   <span class="c"># 注入 5911 进程</span>
<span class="c"># 弹出 Alert</span>
<span class="nv">$ </span>var alert <span class="o">=</span> <span class="o">[[</span>UIAlertView alloc] initWithTitle:@<span class="s2">"Hack You"</span> message:@<span class="s2">"I've hacked you"</span> delegate:nil cancelButtonTitle:@<span class="s2">"Yes"</span> otherButtonTitles:@<span class="s2">"No"</span>, nil]<span class="p">;</span>
<span class="nv">$ </span><span class="o">[</span>alert show]<span class="p">;</span>
</code></pre></div></div>

<h2 id="mobsf-静态扫描">MobSF 静态扫描</h2>
<p>参照<a href="https://linuxhint.com/install_docker_kali_linux/">手册</a>安装 docker 版 <code class="language-plaintext highlighter-rouge">MobSF</code> 并启动：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull opensecurity/mobile-security-framework-mobsf
docker run opensecurity/mobile-security-framework-mobsf
</code></pre></div></div>

<p>查找该 docker MobSF 监听的端口：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps
docker inspect &lt;container_id&gt; | <span class="nb">grep </span>IPAddress
</code></pre></div></div>

<p>然后浏览器访问 <a href="http://IPAddress:8000/">http://IPAddress:8000/</a>，将上一步 dump 的 ipa 文件上传并开始静态分析。</p>

<blockquote>

  <p><a href="https://cornerpirate.com/2020/09/22/getting-started-with-ios-testing/">Getting started with iOS testing</a></p>
</blockquote>
<br/><p>Comments:</p>

<script src="https://utteranc.es/client.js"
        repo="5cr1pt/commnets.blog.securitainment.io"
        issue-term="url"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
<div><a src='https://blog.securitainment.io'>HOME</a>
</div>
<div style="display:none">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-137221448-1', 'auto');
    ga('send', 'pageview');

  </script>
</div>

        </div>
    </main>

    
    </body>
</html>
