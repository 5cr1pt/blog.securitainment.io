<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    
      MS07-040 .NET Framework中的漏洞可能允许远程执行代码
    
  </title>

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="MS07-040 .NET Framework中的漏洞可能允许远程执行代码" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="learn code hack" />
<meta property="og:description" content="learn code hack" />
<link rel="canonical" href="https://blog.securitainment.io/pentest/microsoft/2016/05/14/ms07-040.html" />
<meta property="og:url" content="https://blog.securitainment.io/pentest/microsoft/2016/05/14/ms07-040.html" />
<meta property="og:site_name" content="Securitainment.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-05-14T08:58:49+08:00" />
<script type="application/ld+json">
{"url":"https://blog.securitainment.io/pentest/microsoft/2016/05/14/ms07-040.html","dateModified":"2016-05-14T08:58:49+08:00","datePublished":"2016-05-14T08:58:49+08:00","headline":"MS07-040 .NET Framework中的漏洞可能允许远程执行代码","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.securitainment.io/pentest/microsoft/2016/05/14/ms07-040.html"},"description":"learn code hack","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://blog.securitainment.io/feed.xml" title="Securitainment.io" />

  <link rel="shortcut icon" type="image/x-icon" href="/" />
  <link rel="stylesheet" href="https://blog.securitainment.io/assets/css/main.css" />
</head>
<body>
    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a href="https://blog.securitainment.io"></a>
<h1>MS07-040 .NET Framework中的漏洞可能允许远程执行代码</h1>
<!--more-->

<h1 id="ms07-040"><a href="https://technet.microsoft.com/library/security/ms07-040">MS07-040</a></h1>

<p><em>Microsoft .Net Framework多个空字节注入漏洞</em></p>

<h2 id="受影响系统">受影响系统</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Microsoft .NET Framework 2.0
Microsoft .NET Framework 1.1
Microsoft .NET Framework 1.0
</code></pre></div></div>

<h2 id="描述">描述</h2>

<p>BUGTRAQ  ID: <a href="http://www.securityfocus.com/bid/24791">24791</a></p>

<p>CVE(CAN) ID: <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-0042">CVE-2007-0042</a></p>

<p>Microsoft .NET Framework是一个流行的软件开发工具包。</p>

<p>.NET Framework在处理网页请求时存在漏洞，远程攻击可能利用此漏洞绕过安全限制访问到敏感信息。</p>

<p>.NET Framework的Server.MapPath、Server.Execute、Server.Transfer、String.Compare、System.Net.Mail.SmtpMail.Send方式没有正确地验证某些用户输入参数，允许用户在提交的URI中注入任意空字节。成功地利用此漏洞的攻击者绕过ASP.NET网站的安全限制下载任何网页的内容。</p>

<blockquote>
  <p>来源：Paul Craig （headpimp@pimp-industries.com）</p>
</blockquote>

<blockquote>
  <p>链接：http://security-assessment.com/files/advisories/2007-07-11<em>Multiple</em>.NET_Null_Byte_Injection_Vulnera
http://secunia.com/advisories/26003/
http://www.microsoft.com/technet/security/Bulletin/ms07-040.mspx?pf=true
http://www.us-cert.gov/cas/techalerts/TA07-191A.html</p>
</blockquote>

<h2 id="测试方法">测试方法</h2>

<ul>
  <li>
    <p>例1：</p>

    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="err">%@</span> <span class="n">Page</span> <span class="n">Language</span><span class="o">=</span><span class="s">"vb"</span> <span class="err">%</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">vb</span><span class="p">.</span><span class="n">net</span> <span class="n">MapPath</span> <span class="n">example</span> <span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">script</span> <span class="n">runat</span><span class="o">=</span><span class="s">"server"</span><span class="o">&gt;</span>

           <span class="k">Sub</span> <span class="nf">Page_Load</span><span class="p">()</span>
                <span class="n">dim</span> <span class="n">name</span> <span class="n">as</span> <span class="n">string</span>
                <span class="n">dim</span> <span class="n">realname</span> <span class="n">as</span> <span class="n">string</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">".uploaded"</span>
                <span class="n">realname</span> <span class="o">=</span> <span class="n">Mappath</span><span class="p">(</span><span class="s">"."</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">"\"</span> <span class="o">&amp;</span> <span class="n">name</span>
            <span class="n">response</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Mappath of name = &lt;b&gt;"</span> <span class="o">&amp;</span> <span class="n">MapPath</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">"&lt;/b&gt;&lt;br&gt;"</span><span class="p">)</span>
                 <span class="n">response</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"The real value is: &lt;b&gt;"</span> <span class="o">&amp;</span> <span class="n">realname</span> <span class="o">&amp;</span> <span class="s">"&lt;/b&gt;&lt;br&gt;"</span><span class="p">)</span>
           <span class="k">End</span> <span class="k">Sub</span>
        <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">asp</span><span class="p">:</span><span class="n">label</span> <span class="n">id</span><span class="o">=</span><span class="s">"Message"</span> <span class="n">runat</span><span class="o">=</span><span class="s">"server"</span><span class="o">/&gt;</span>
     <span class="o">&lt;</span><span class="n">asp</span><span class="p">:</span><span class="n">label</span> <span class="n">id</span><span class="o">=</span><span class="s">"Message2"</span> <span class="n">runat</span><span class="o">=</span><span class="s">"server"</span><span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>例2：</p>

    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="err">%@</span> <span class="n">Page</span> <span class="n">Language</span><span class="o">=</span><span class="s">"VB"</span> <span class="err">%</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
 			<span class="o">&lt;</span><span class="n">script</span> <span class="n">runat</span><span class="o">=</span><span class="s">"server"</span><span class="o">&gt;</span>
    			<span class="k">Sub</span> <span class="nf">Page_Load</span><span class="p">()</span>
       		<span class="n">Server</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="s">"page"</span><span class="p">))</span>
        		<span class="k">End</span> <span class="k">Sub</span>
 			<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>例3：</p>

    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="err">%@</span> <span class="n">Page</span> <span class="n">Language</span><span class="o">=</span><span class="s">"VB"</span> <span class="err">%</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Server</span><span class="p">.</span><span class="n">execute</span> <span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">script</span> <span class="n">runat</span><span class="o">=</span><span class="s">"server"</span><span class="o">&gt;</span>
        <span class="k">Sub</span> <span class="nf">Page_Load</span><span class="p">()</span>
        <span class="n">Server</span><span class="p">.</span><span class="n">Transfer</span><span class="p">(</span><span class="n">request</span><span class="p">(</span><span class="s">"page"</span><span class="p">))</span>
        <span class="k">End</span> <span class="k">Sub</span>
     <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>例4：</p>

    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="err">%@</span> <span class="n">Page</span> <span class="n">Language</span><span class="o">=</span><span class="s">"vb"</span> <span class="err">%</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="kt">String</span><span class="p">.</span><span class="n">Compare</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">script</span> <span class="n">runat</span><span class="o">=</span><span class="s">"server"</span><span class="o">&gt;</span>
           <span class="k">Sub</span> <span class="nf">Page_Load</span><span class="p">()</span>
              <span class="n">dim</span> <span class="n">allowed</span><span class="p">,</span> <span class="n">sFirstItem</span><span class="p">,</span> <span class="n">sSecondItem</span> <span class="n">as</span> <span class="n">string</span>
              <span class="n">sFirstItem</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">"first"</span><span class="p">)</span>
              <span class="n">sSecondItem</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="s">"second"</span><span class="p">)</span>
              <span class="n">response</span><span class="p">.</span><span class="n">Write</span> <span class="p">(</span><span class="s">"String.Compare - First item = "</span> <span class="o">&amp;</span> <span class="n">sFirstItem</span> <span class="o">&amp;</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>
              <span class="n">response</span><span class="p">.</span><span class="n">Write</span> <span class="p">(</span><span class="s">"String.Compare - Second item = "</span> <span class="o">&amp;</span> <span class="n">sSecondItem</span> <span class="o">&amp;</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>
              <span class="n">if</span> <span class="kt">String</span><span class="p">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">sFirstItem</span><span class="p">,</span> <span class="n">sSecondItem</span><span class="p">)</span> <span class="o">=</span><span class="mi">0</span> <span class="n">then</span>
                  <span class="n">response</span><span class="p">.</span><span class="n">Write</span> <span class="p">(</span><span class="s">"&lt;b&gt;String.Compare - Matched! Strings are the same&lt;/b&gt;"</span> <span class="o">&amp;</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>
              <span class="n">else</span>
                  <span class="n">response</span><span class="p">.</span><span class="n">Write</span> <span class="p">(</span><span class="s">"&lt;b&gt;String.Compare - Failed!! Strings are diffrent &lt;/b&gt;"</span> <span class="o">&amp;</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>
              <span class="k">End</span> <span class="k">If</span>
              <span class="n">if</span> <span class="n">sFirstItem</span><span class="o">=</span><span class="n">sSecondItem</span> <span class="n">then</span>
                  <span class="n">response</span><span class="p">.</span><span class="n">Write</span> <span class="p">(</span><span class="s">"Direct eval - Matched!"</span> <span class="o">&amp;</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>
                  <span class="n">else</span>
                  <span class="n">response</span><span class="p">.</span><span class="n">Write</span> <span class="p">(</span><span class="s">"&lt;b&gt;Direct eval - Failed!!&lt;/b&gt;"</span> <span class="o">&amp;</span> <span class="s">"&lt;br&gt;"</span><span class="p">)</span>
              <span class="k">End</span> <span class="k">If</span>
           <span class="k">End</span> <span class="k">Sub</span>
        <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>例5：</p>

    <div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="err">%</span> <span class="err">@</span><span class="n">Import</span> <span class="k">Namespace</span><span class="err">="</span><span class="nn">System.Web.Mail</span><span class="s">" %&gt;
  &lt;% @Import Namespace="</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="s">" %&gt;
  &lt;%@ Page Language="</span><span class="n">vb</span><span class="s">" %&gt;
  &lt;html&gt;
     &lt;head&gt;
        &lt;title&gt;vb.net MapPath example &lt;/title&gt;
        &lt;script runat="</span><span class="n">server</span><span class="s">"&gt;
          Private Sub Page_Load(sender As Object, e As System.EventArgs)
          Dim m As New MailMessage()
          m.From = "</span><span class="n">tester@security</span><span class="o">-</span><span class="n">assessment</span><span class="p">.</span><span class="n">com</span><span class="s">"
          m.To = request("</span><span class="n">to</span><span class="s">") &amp; "</span><span class="err">@</span><span class="n">security</span><span class="o">-</span><span class="n">assessment</span><span class="p">.</span><span class="n">com</span><span class="s">"
          m.Subject = request("</span><span class="n">subject</span><span class="s">") &amp; "</span><span class="p">:</span> <span class="n">FromWebsite</span><span class="s">"
          m.Body = request("</span><span class="n">body</span><span class="s">") &amp; "</span><span class="n">This</span> <span class="n">message</span> <span class="n">was</span> <span class="n">submitted</span> <span class="n">by</span> <span class="n">a</span> <span class="n">user</span><span class="p">.</span><span class="err">"</span>
          <span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">"Sending mail to: "</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">.</span><span class="n">to</span><span class="p">)</span>
          <span class="n">m</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"http://schemas.microsoft.com/cdo/configuration/smtpauthenticate"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">)</span> <span class="c1">'basic authentication</span>
          <span class="n">m</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"http://schemas.microsoft.com/cdo/configuration/sendusername"</span><span class="p">,</span> <span class="s">"username-goes-here"</span><span class="p">)</span>
          <span class="n">m</span><span class="p">.</span><span class="n">Fields</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"http://schemas.microsoft.com/cdo/configuration/sendpassword"</span><span class="p">,</span> <span class="s">"password-goes-here"</span><span class="p">)</span> <span class="c1">'set your</span>
          <span class="n">SmtpMail</span><span class="p">.</span><span class="n">SmtpServer</span> <span class="o">=</span> <span class="s">"mail.server.here"</span>
          <span class="n">SmtpMail</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
          <span class="k">End</span> <span class="k">Sub</span>
        <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>
<br/><p>Comments:</p>

<script src="https://utteranc.es/client.js"
        repo="5cr1pt/commnets.blog.securitainment.io"
        issue-term="url"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
<div><a href='https://blog.securitainment.io' style='text-align:center'>HOME</a>
</div>
<div style="display:none">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-137221448-1', 'auto');
    ga('send', 'pageview');

  </script>
</div>

        </div>
    </main>

    
    </body>
</html>
